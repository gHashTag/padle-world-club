---
title: "üîç –†–ï–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê - –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢"
description: "–ß–µ—Å—Ç–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É PostgreSQL –∏ Obsidian"
tags: [architecture, reality, sync, explanation]
date: "2025-01-31"
---

# üîç –†–ï–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê - –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢

## üéØ **–í–´ –ü–†–ê–í–´! –ï–°–¢–¨ –ü–†–û–ë–õ–ï–ú–ê**

### ‚ùå **–¢–µ–∫—É—â–∞—è –°–∏—Ç—É–∞—Ü–∏—è**

```mermaid
graph TB
    subgraph "üóÑÔ∏è PostgreSQL (–ò—Å—Ç–æ—á–Ω–∏–∫ –ò—Å—Ç–∏–Ω—ã)"
        PG[(PostgreSQL Database)]
        U1[User 1: David Smith]
        U2[User 2: Anna Johnson]
        U3[User 3: Sarah Brown]
    end
    
    subgraph "üìÅ Obsidian Files (–ö–æ–ø–∏–∏)"
        OF1[User-David-Smith.md]
        OF2[User-Anna-Johnson.md]
        OF3[User-Sarah-Brown.md]
        OT[Users-Data.md - –¢–∞–±–ª–∏—Ü–∞]
    end
    
    subgraph "üåê API Endpoints"
        API[POST /api/users]
        API2[GET /api/users]
        API3[PUT /api/users/:id]
    end
    
    subgraph "üîÑ Sync Script"
        SS[obsidian-db-sync.mjs]
        EX[exportAllTables()]
        WT[startWatching()]
    end
    
    %% –û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
    PG --> SS
    SS --> OF1
    SS --> OF2
    SS --> OF3
    SS --> OT
    
    %% API —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ë–î
    API --> PG
    API2 --> PG
    API3 --> PG
    
    %% –ü—Ä–æ–±–ª–µ–º–∞: –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —á–µ—Ä–µ–∑ API –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Obsidian –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    API -.->|‚ùå –ù–ï–¢ –ê–í–¢–û–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò| OF1
    
    style PG fill:#e8f5e8
    style API fill:#ffebee
    style SS fill:#fff3e0
```

### üö® **–ü–†–û–ë–õ–ï–ú–´**

#### 1. **–û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**
```javascript
// –†–∞–±–æ—Ç–∞–µ—Ç: PostgreSQL ‚Üí Obsidian
node scripts/obsidian-db-sync.mjs full-sync

// –ù–ï –†–ê–ë–û–¢–ê–ï–¢: API ‚Üí Obsidian (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
// –ï—Å–ª–∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API, –æ–Ω –ù–ï –ø–æ—è–≤–∏—Ç—Å—è –≤ Obsidian
```

#### 2. **–†—É—á–Ω–æ–π –ó–∞–ø—É—Å–∫ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
```bash
# –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑
node scripts/obsidian-db-sync.mjs full-sync
```

#### 3. **–ù–µ—Ç Real-Time –æ—Ç API –∫ Obsidian**
```javascript
// –ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API:
POST /api/users ‚Üí PostgreSQL ‚úÖ
PostgreSQL ‚Üí Obsidian ‚ùå (–Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)
```

## üîß **–ö–ê–ö –≠–¢–û –î–û–õ–ñ–ù–û –†–ê–ë–û–¢–ê–¢–¨**

### ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

```mermaid
graph TB
    subgraph "üåê API Layer"
        API[Express API]
        WH[Webhook Handler]
        MW[Sync Middleware]
    end
    
    subgraph "üóÑÔ∏è Database Layer"
        PG[(PostgreSQL)]
        TR[Database Triggers]
        NT[Notification System]
    end
    
    subgraph "üîÑ Sync Layer"
        SS[Sync Service]
        WS[WebSocket Server]
        QU[Queue System]
    end
    
    subgraph "üìÅ Obsidian Layer"
        OF[Obsidian Files]
        RL[Relay Plugin]
        DV[Dataview Tables]
    end
    
    subgraph "üë• Users"
        U1[User 1 - API]
        U2[User 2 - Obsidian]
        U3[User 3 - Mobile App]
    end
    
    %% API Operations
    U1 --> API
    U3 --> API
    API --> MW
    MW --> PG
    
    %% Database Triggers
    PG --> TR
    TR --> NT
    NT --> WH
    
    %% Sync Process
    WH --> SS
    SS --> QU
    QU --> OF
    
    %% Real-time Updates
    SS --> WS
    WS --> RL
    RL --> U2
    
    %% Obsidian to API
    U2 --> OF
    OF --> SS
    SS --> API
    
    style PG fill:#e8f5e8
    style API fill:#e3f2fd
    style SS fill:#fff3e0
    style OF fill:#f3e5f5
```

## üõ†Ô∏è **–†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´**

### üéØ **–ß—Ç–æ –ù—É–∂–Ω–æ –î–æ–±–∞–≤–∏—Ç—å**

#### 1. **Database Triggers + Webhooks**
```sql
-- –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä –≤ PostgreSQL
CREATE OR REPLACE FUNCTION notify_obsidian_sync()
RETURNS TRIGGER AS $$
BEGIN
    -- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
    PERFORM pg_notify('obsidian_sync', json_build_object(
        'table', TG_TABLE_NAME,
        'action', TG_OP,
        'data', row_to_json(NEW)
    )::text);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ —Ç–∞–±–ª–∏—Ü–µ users
CREATE TRIGGER user_sync_trigger
    AFTER INSERT OR UPDATE OR DELETE ON "user"
    FOR EACH ROW EXECUTE FUNCTION notify_obsidian_sync();
```

#### 2. **Webhook Endpoint –≤ API**
```javascript
// src/api/routes/obsidian-webhooks.ts
app.post('/api/webhooks/obsidian-sync', async (req, res) => {
  const { table, action, data } = req.body;
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
  await syncTableToObsidian(table, action, data);
  
  res.json({ success: true });
});
```

#### 3. **Auto-Sync Service**
```javascript
// services/obsidian-auto-sync.js
class ObsidianAutoSync {
  constructor() {
    this.setupDatabaseListener();
  }
  
  setupDatabaseListener() {
    // –°–ª—É—à–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç PostgreSQL
    this.client.on('notification', async (msg) => {
      const { table, action, data } = JSON.parse(msg.payload);
      await this.syncToObsidian(table, action, data);
    });
  }
  
  async syncToObsidian(table, action, data) {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ Obsidian
    if (table === 'user') {
      await this.updateUserFile(data);
      await this.updateUsersTable();
    }
  }
}
```

## üîÑ **–ü–û–õ–ù–´–ô FLOW CRUD –û–ü–ï–†–ê–¶–ò–ô**

### ‚úÖ **CREATE (–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Flow)**

```mermaid
sequenceDiagram
    participant API as üåê API Client
    participant EXP as üõ£Ô∏è Express API
    participant PG as üóÑÔ∏è PostgreSQL
    participant TR as ‚ö° DB Trigger
    participant WH as üîó Webhook
    participant SS as üîÑ Sync Service
    participant OF as üìÅ Obsidian Files
    participant OB as üë§ Obsidian Users

    API->>EXP: POST /api/users (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
    EXP->>PG: INSERT INTO users
    PG->>TR: Trigger —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
    TR->>WH: pg_notify('obsidian_sync')
    WH->>SS: Webhook –≤—ã–∑–æ–≤
    SS->>OF: –°–æ–∑–¥–∞–µ—Ç User-NewUser.md
    SS->>OF: –û–±–Ω–æ–≤–ª—è–µ—Ç Users-Data.md
    OF->>OB: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    Note over API,OB: ‚ö° –í—Ä–µ–º—è: 1-2 —Å–µ–∫—É–Ω–¥—ã
```

### ‚ùå **–¢–µ–∫—É—â–∏–π Broken Flow**

```mermaid
sequenceDiagram
    participant API as üåê API Client
    participant EXP as üõ£Ô∏è Express API
    participant PG as üóÑÔ∏è PostgreSQL
    participant OF as üìÅ Obsidian Files
    participant OB as üë§ Obsidian Users

    API->>EXP: POST /api/users (–Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
    EXP->>PG: INSERT INTO users
    PG->>PG: –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
    
    Note over OF,OB: ‚ùå Obsidian –ù–ï –ó–ù–ê–ï–¢ –æ –Ω–æ–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    
    OB->>OF: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É
    OF->>OB: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –°–¢–ê–†–´–ï –¥–∞–Ω–Ω—ã–µ
    
    Note over API,OB: üîß –ù—É–∂–µ–Ω —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫: node scripts/obsidian-db-sync.mjs full-sync
```

## üéØ **–ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### üöÄ **–≠—Ç–∞–ø 1: Database Triggers (1 –¥–µ–Ω—å)**
```sql
-- –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
CREATE TRIGGER user_sync_trigger AFTER INSERT OR UPDATE OR DELETE ON "user";
CREATE TRIGGER booking_sync_trigger AFTER INSERT OR UPDATE OR DELETE ON "booking";
CREATE TRIGGER payment_sync_trigger AFTER INSERT OR UPDATE OR DELETE ON "payment";
-- ... –¥–ª—è –≤—Å–µ—Ö 31 —Ç–∞–±–ª–∏—Ü—ã
```

### üöÄ **–≠—Ç–∞–ø 2: Webhook Handler (1 –¥–µ–Ω—å)**
```javascript
// src/api/routes/obsidian-sync.ts
router.post('/webhook', async (req, res) => {
  const { table, action, data } = req.body;
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
  await obsidianSyncService.syncTable(table, action, data);
  
  res.json({ success: true });
});
```

### üöÄ **–≠—Ç–∞–ø 3: Auto-Sync Service (2 –¥–Ω—è)**
```javascript
// services/obsidian-auto-sync.service.ts
export class ObsidianAutoSyncService {
  async syncTable(table: string, action: string, data: any) {
    switch(table) {
      case 'user':
        await this.syncUser(action, data);
        break;
      case 'booking':
        await this.syncBooking(action, data);
        break;
      // ... –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
    }
  }
}
```

### üöÄ **–≠—Ç–∞–ø 4: Real-Time WebSockets (2 –¥–Ω—è)**
```javascript
// Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è Obsidian
io.on('connection', (socket) => {
  socket.on('subscribe_table', (tableName) => {
    socket.join(`table_${tableName}`);
  });
});

// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
io.to(`table_users`).emit('table_updated', {
  table: 'users',
  action: 'create',
  data: newUser
});
```

## üèÜ **–†–ï–ó–£–õ–¨–¢–ê–¢**

### ‚úÖ **–ü–æ—Å–ª–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

```mermaid
graph LR
    A[üë§ –°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API] --> B[üóÑÔ∏è PostgreSQL]
    B --> C[‚ö° Trigger]
    C --> D[üîó Webhook]
    D --> E[üìÅ Obsidian Update]
    E --> F[üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è]
    
    G[üë§ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ Obsidian] --> H[üìÅ File Change]
    H --> I[üëÄ Watcher]
    I --> J[üåê API Call]
    J --> B
    
    style A fill:#e3f2fd
    style F fill:#e8f5e8
    style G fill:#f3e5f5
```

### üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**
1. **–ò—Å—Ç–∏–Ω–Ω—ã–π Real-Time** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
2. **–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

*üîç –ß–µ—Å—Ç–Ω–∞—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ - –û—Å–Ω–æ–≤–∞ –†–µ—à–µ–Ω–∏—è*
*üõ†Ô∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - –ü—É—Ç—å –∫ –£—Å–ø–µ—Ö—É*
*üèùÔ∏è Phangan Padel Tennis Club - Real-Time CRM*
