# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Wizard-—Å—Ü–µ–Ω –≤ Instagram Scraper Bot

## –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Wizard-—Å—Ü–µ–Ω –≤ Instagram Scraper Bot –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `WizardScene` –≤–º–µ—Å—Ç–æ `BaseScene`. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±—ã–ª –ø—Ä–æ–≤–µ–¥–µ–Ω —Å —Ü–µ–ª—å—é —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ–¥—Ö–æ–¥–∞ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å—Ü–µ–Ω, —É–ª—É—á—à–µ–Ω–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞.

## –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–í—Å–µ —Å—Ü–µ–Ω—ã –≤ –±–æ—Ç–µ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –Ω–∞ –æ—Å–Ω–æ–≤–µ `WizardScene` –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Telegraf. –ö–∞–∂–¥–∞—è —Å—Ü–µ–Ω–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1. **–®–∞–≥–∏ (Steps)** - —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —à–∞–≥–∞–º–∏ —Å—Ü–µ–Ω—ã.
2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ (Button Handlers)** - —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –±–æ—Ç–∞.
3. **–£—Ç–∏–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏.
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.

## –°–ø–∏—Å–æ–∫ Wizard-—Å—Ü–µ–Ω

–í –±–æ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ Wizard-—Å—Ü–µ–Ω—ã:

1. `projectWizardScene` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
2. `competitorWizardScene` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏
3. `hashtagWizardScene` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–µ—à—Ç–µ–≥–∞–º–∏
4. `scrapingWizardScene` - –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
5. `reelsWizardScene` - –ø—Ä–æ—Å–º–æ—Ç—Ä Reels
6. `analyticsWizardScene` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ Reels
7. `notificationWizardScene` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
8. `reelsCollectionWizardScene` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ Reels
9. `chatbotWizardScene` - —á–∞—Ç-–±–æ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞–º–∏ –≤–∏–¥–µ–æ

## –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–í–æ –≤—Å–µ—Ö Wizard-—Å—Ü–µ–Ω–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### 1. `clearSessionState`

–§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º –∏–∑ —Å—Ü–µ–Ω—ã –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –¥—Ä—É–≥–æ–º—É —à–∞–≥—É.

```typescript
/**
 * –û—á–∏—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º –∏–∑ —Å—Ü–µ–Ω—ã
 * @param ctx –ö–æ–Ω—Ç–µ–∫—Å—Ç Telegraf
 * @param reason –ü—Ä–∏—á–∏–Ω–∞ –æ—á–∏—Å—Ç–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
 */
function clearSessionState(ctx: ScraperBotContext, reason: string = "general"): void {
  if (ctx.scene.session) {
    logger.info(`[SceneName] Clearing session state before leaving (reason: ${reason})`);
    // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è
    ctx.scene.session.step = undefined;
    ctx.scene.session.currentItemId = undefined;
    // –î–ª—è Wizard-—Å—Ü–µ–Ω
    if (ctx.wizard && ctx.wizard.state) {
      ctx.wizard.state = {};
    }
  }
}
```

### 2. `safeSceneTransition`

–§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫.

```typescript
/**
 * –í—ã–ø–æ–ª–Ω—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ –¥—Ä—É–≥—É—é —Å—Ü–µ–Ω—É —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
 * @param ctx –ö–æ–Ω—Ç–µ–∫—Å—Ç Telegraf
 * @param targetScene –¶–µ–ª–µ–≤–∞—è —Å—Ü–µ–Ω–∞
 * @param reason –ü—Ä–∏—á–∏–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è)
 */
async function safeSceneTransition(
  ctx: ScraperBotContext,
  targetScene: string = "project_wizard",
  reason: string = "general"
): Promise<void> {
  try {
    logger.info(`[SceneName] Transitioning to ${targetScene} scene (reason: ${reason})`);
    await ctx.scene.enter(targetScene);
  } catch (error) {
    logger.error(`[SceneName] Error entering ${targetScene} scene:`, error);
    await ctx.scene.leave();
  }
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Wizard-—Å—Ü–µ–Ω—ã

–ö–∞–∂–¥–∞—è Wizard-—Å—Ü–µ–Ω–∞ –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```typescript
import { Scenes, Markup } from "telegraf";
import type { ScraperBotContext } from "../types";
import { logger } from "../logger";

// –£—Ç–∏–ª–∏—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function clearSessionState(ctx: ScraperBotContext, reason: string = "general"): void {
  // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
}

async function safeSceneTransition(
  ctx: ScraperBotContext,
  targetScene: string = "project_wizard",
  reason: string = "general"
): Promise<void> {
  // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
}

// Wizard-—Å—Ü–µ–Ω–∞
export class MyWizardScene extends Scenes.WizardScene<ScraperBotContext> {
  constructor(storage: StorageAdapter) {
    super(
      "my_wizard_scene_id",
      
      // –®–∞–≥ 1
      async (ctx) => {
        logger.info(`[MyWizard] –®–∞–≥ 1: –û–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞`);
        logger.debug(`[MyWizard] –°–æ–¥–µ—Ä–∂–∏–º–æ–µ ctx.wizard.state:`, ctx.wizard.state);
        
        // –õ–æ–≥–∏–∫–∞ —à–∞–≥–∞
        
        return; // –û—Å—Ç–∞–µ–º—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–º —à–∞–≥–µ –∏–ª–∏ ctx.wizard.next() –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
      },
      
      // –®–∞–≥ 2
      async (ctx) => {
        logger.info(`[MyWizard] –®–∞–≥ 2: –û–ø–∏—Å–∞–Ω–∏–µ —à–∞–≥–∞`);
        logger.debug(`[MyWizard] –°–æ–¥–µ—Ä–∂–∏–º–æ–µ ctx.wizard.state:`, ctx.wizard.state);
        
        // –õ–æ–≥–∏–∫–∞ —à–∞–≥–∞
        
        return;
      }
    );
    
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
    this.registerButtonHandlers();
  }

  /**
   * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
   */
  private registerButtonHandlers(): void {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏
    this.action("button_id", async (ctx) => {
      logger.info(`[MyWizard] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'button_id' –≤—ã–∑–≤–∞–Ω`);
      await ctx.answerCbQuery();
      
      // –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
      
      return ctx.wizard.selectStep(0); // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É —à–∞–≥—É
    });
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å—Ü–µ–Ω—ã
    this.action("exit", async (ctx) => {
      logger.info(`[MyWizard] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'exit' –≤—ã–∑–≤–∞–Ω`);
      await ctx.answerCbQuery();
      
      // –û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ –¥—Ä—É–≥—É—é —Å—Ü–µ–Ω—É
      clearSessionState(ctx, "exit_button_clicked");
      await safeSceneTransition(ctx, "project_wizard", "exit_button_clicked");
    });
  }
}

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–æ–º–∞–Ω–¥—ã
export function setupMyWizard(bot: any) {
  bot.command('my_command', async (ctx: any) => {
    logger.info("[MyWizard] Command /my_command triggered");
    await ctx.scene.enter('my_wizard_scene_id');
  });
}

export default MyWizardScene;
```

## –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω –≤ –±–æ—Ç–µ

–í—Å–µ Wizard-—Å—Ü–µ–Ω—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `index.ts` —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```typescript
// –ò–º–ø–æ—Ä—Ç —Å—Ü–µ–Ω
import { MyWizardScene, setupMyWizard } from "./src/scenes/my-wizard-scene";

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
function initBot(
  bot: Telegraf<ScraperBotContext>,
  storageAdapter: StorageAdapter,
  config: InstagramScraperBotConfig
) {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ü–µ–Ω—ã
  const stage = new Scenes.Stage<ScraperBotContext>([
    new MyWizardScene(storageAdapter),
    // –î—Ä—É–≥–∏–µ —Å—Ü–µ–Ω—ã
  ]);

  // –ü–æ–¥–∫–ª—é—á–∞–µ–º Stage middleware
  bot.use(stage.middleware() as Middleware<ScraperBotContext>);

  // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è wizard-—Å—Ü–µ–Ω
  setupMyWizard(bot);
  // –î—Ä—É–≥–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

  // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
  bot.command("my_command", (ctx) =>
    ctx.scene.enter("my_wizard_scene_id")
  );
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Wizard-—Å—Ü–µ–Ω –∏–º–µ–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è** - –≤—Å–µ —Å—Ü–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É.
2. **–£–ª—É—á—à–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `clearSessionState` –∏ `safeSceneTransition` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –æ—á–∏—Å—Ç–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ü–µ–Ω–∞–º–∏.
3. **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∫–∞–∂–¥—ã–π —à–∞–≥ –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–º–µ–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –æ—Ç–ª–∞–¥–∫—É.
4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –ø–æ–≤—ã—à–∞—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –±–æ—Ç–∞.
5. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–≥–∞

```typescript
// –®–∞–≥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
async (ctx) => {
  logger.info(`[MyWizard] –®–∞–≥: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤`);
  logger.debug(`[MyWizard] –°–æ–¥–µ—Ä–∂–∏–º–æ–µ ctx.wizard.state:`, ctx.wizard.state);
  
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  const { projectId } = ctx.wizard.state;
  
  if (!projectId) {
    logger.error("[MyWizard] Project ID is undefined");
    await ctx.reply(
      "–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞."
    );
    clearSessionState(ctx, "missing_project_id");
    await safeSceneTransition(ctx, "project_wizard", "missing_project_id");
    return;
  }
  
  try {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    const items = await ctx.storage.getItemsByProjectId(projectId);
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    let message = "üìã *–°–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤*\n\n";
    
    if (items.length === 0) {
      message += "–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç.";
    } else {
      items.forEach((item, index) => {
        message += `${index + 1}. ${item.name}\n`;
      });
    }
    
    // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    const keyboard = Markup.inlineKeyboard([
      [Markup.button.callback("‚ûï –î–æ–±–∞–≤–∏—Ç—å", "add_item")],
      [Markup.button.callback("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "back_to_menu")]
    ]);
    
    await ctx.reply(message, {
      parse_mode: "Markdown",
      ...keyboard
    });
  } catch (error) {
    logger.error("[MyWizard] Error loading items:", error);
    await ctx.reply("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
    clearSessionState(ctx, "error_loading_items");
    await safeSceneTransition(ctx, "project_wizard", "error_loading_items");
  }
  
  // –û—Å—Ç–∞–µ–º—Å—è –Ω–∞ —Ç–µ–∫—É—â–µ–º —à–∞–≥–µ
  return;
}
```

### –ü—Ä–∏–º–µ—Ä 2: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫–Ω–æ–ø–∫–∏

```typescript
// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å"
this.action("add_item", async (ctx) => {
  logger.info(`[MyWizard] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'add_item' –≤—ã–∑–≤–∞–Ω`);
  await ctx.answerCbQuery();
  
  // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —à–∞–≥—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞
  return ctx.wizard.selectStep(2);
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
this.action("back_to_menu", async (ctx) => {
  logger.info(`[MyWizard] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ 'back_to_menu' –≤—ã–∑–≤–∞–Ω`);
  await ctx.answerCbQuery();
  
  // –û—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ –¥—Ä—É–≥—É—é —Å—Ü–µ–Ω—É
  clearSessionState(ctx, "back_to_menu_clicked");
  await safeSceneTransition(ctx, "project_wizard", "back_to_menu_clicked");
});
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Wizard-—Å—Ü–µ–Ω –≤ Instagram Scraper Bot –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Å—Ü–µ–Ω, —É–ª—É—á—à–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –ø–æ–≤—ã—à–µ–Ω–Ω—É—é –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –±–æ—Ç–∞. –°–ª–µ–¥—É—è —ç—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å—Ü–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –æ–±—â–µ–º—É —Å—Ç–∏–ª—é –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ø—Ä–æ–µ–∫—Ç–∞.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞—Ö –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ Wizard-—Å—Ü–µ–Ω —Å–º. —Å–ª–µ–¥—É—é—â–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:

- [WIZARD_SCENE_PATTERNS.md](./WIZARD_SCENE_PATTERNS.md) - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
- [WIZARD_SCENE_REFACTORING_CHECKLIST.md](./WIZARD_SCENE_REFACTORING_CHECKLIST.md) - —á–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Wizard-—Å—Ü–µ–Ω
- [SUCCESS_HISTORY_WIZARD_SCENES.md](./SUCCESS_HISTORY_WIZARD_SCENES.md) - –∏—Å—Ç–æ—Ä–∏—è —É—Å–ø–µ—Ö–∞ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
