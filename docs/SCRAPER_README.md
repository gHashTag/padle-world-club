# üì∑ Instagram Reels Scraper –¥–ª—è –≠—Å—Ç–µ—Ç–∏—á–µ—Å–∫–æ–π –ú–µ–¥–∏—Ü–∏–Ω—ã

–ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω—ã–π —Å–∫—Ä–∞–ø–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ Instagram Reels —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –Ω–∏—à–µ —ç—Å—Ç–µ—Ç–∏—á–µ—Å–∫–æ–π –º–µ–¥–∏—Ü–∏–Ω—ã. –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç Reels –ø–æ –∞–∫–∫–∞—É–Ω—Ç–∞–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ —Ö—ç—à—Ç–µ–≥–∞–º, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö Neon –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–æ–±—Ä–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

## üî• –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–æ–µ–∫—Ç–æ–≤
- **–°–∫—Ä–∞–ø–∏–Ω–≥ –∫–æ–Ω—Ç–µ–Ω—Ç–∞**: –°–±–æ—Ä Reels –∏–∑ Instagram –ø–æ
  - –ê–∫–∫–∞—É–Ω—Ç–∞–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
  - –•—ç—à—Ç–µ–≥–∞–º
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**:
  - –ü–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º (–º–∏–Ω. –ø—Ä–æ—Å–º–æ—Ç—Ä—ã)
  - –ü–æ –¥–∞—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (–Ω–µ —Å—Ç–∞—Ä—à–µ X –¥–Ω–µ–π)
- **–£–¥–æ–±–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ Neon Database (PostgreSQL)
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –°–∫—Ä–∏–ø—Ç –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
- **API**: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–∫—Ä–∞–ø–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

1. **Users**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
2. **Projects**: –ü—Ä–æ–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **CompetitorAccounts**: –ê–∫–∫–∞—É–Ω—Ç—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
4. **TrackingHashtags**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Ö—ç—à—Ç–µ–≥–∏
5. **InstagramReels**: –î–∞–Ω–Ω—ã–µ –æ —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã—Ö Reels
6. **ContentSources**: –°–≤—è–∑—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ (–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç/—Ö—ç—à—Ç–µ–≥)
7. **UserContentInteractions**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
8. **ParsingLogs**: –õ–æ–≥–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+ / Bun 1.0+
- –ê–∫–∫–∞—É–Ω—Ç –≤ [Neon Database](https://neon.tech)
- –ê–∫–∫–∞—É–Ω—Ç –≤ [Apify](https://apify.com)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**

   ```bash
   git clone <url-repo>
   cd <project-folder>
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

   ```bash
   bun install
   # –∏–ª–∏
   npm install
   ```

3. **–°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª:**

   ```
   NEON_DATABASE_URL=postgres://user:password@host/database
   APIFY_TOKEN=your_apify_token
   DEMO_USER_ID=12345678 # ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –¥–ª—è –¥–µ–º–æ
   MIN_VIEWS=50000 # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –¥–ª—è Reels
   MAX_AGE_DAYS=14 # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç Reels –≤ –¥–Ω—è—Ö
   ```

4. **–°–æ–∑–¥–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   bun run src/agents/scraper/storage/rebuild-multi-tenant-tables.ts CONFIRM=YES
   ```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–∫—Ä–∞–ø–∏–Ω–≥ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

```bash
bun run src/agents/scraper/scripts/seed-competitors.ts
```

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–æ–µ–∫—Ç, –¥–æ–±–∞–≤–∏—Ç –∞–∫–∫–∞—É–Ω—Ç—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç —Å–∫—Ä–∞–ø–∏–Ω–≥ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–∫—Ä–∞–ø–∏–Ω–≥ —Ö—ç—à—Ç–µ–≥–æ–≤

```bash
bun run src/agents/scraper/scripts/seed-hashtags.ts
```

–°–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–∏—Ç —Ö—ç—à—Ç–µ–≥–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ –≤ –ø—Ä–æ–µ–∫—Ç –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç —Å–∫—Ä–∞–ø–∏–Ω–≥ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ö—ç—à—Ç–µ–≥–∞.

#### –ó–∞–ø—É—Å–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞

```bash
bun run src/agents/scraper/scripts/run-daily-scraping.ts
```

–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å—Ç–∏—Ç —Å–∫—Ä–∞–ø–∏–Ω–≥ –¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ —Ö—ç—à—Ç–µ–≥–æ–≤.

–î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞:

```bash
DRY_RUN=true bun run src/agents/scraper/scripts/run-daily-scraping.ts
```

## üìö API —Å–∫—Ä–∞–ø–µ—Ä–∞

–°–∫—Ä–∞–ø–µ—Ä –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏

- `createUser(telegramId, username, firstName, lastName)` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `getUserByTelegramId(telegramId)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram ID
- `getAllActiveUsers()` - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `createProject(userId, name, description, industry)` - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `getProjectsByUserId(userId)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

- `addCompetitorAccount(projectId, instagramUrl, accountName, notes, priority)` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
- `getCompetitorAccounts(projectId, activeOnly)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- `addTrackingHashtag(projectId, hashtag, displayName, notes, priority)` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö—ç—à—Ç–µ–≥–∞
- `getTrackingHashtags(projectId, activeOnly)` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö—ç—à—Ç–µ–≥–æ–≤

### –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

- `scrapeInstagramReels(instagramUrl, options)` - –°–∫—Ä–∞–ø–∏–Ω–≥ Reels
- `saveReels(reels, projectId, sourceType, sourceId)` - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Reels –≤ –±–∞–∑—É
- `getReels(projectId, filters)` - –ü–æ–ª—É—á–µ–Ω–∏–µ Reels —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- `getProjectStats(projectId)` - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç—É

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º

- `addToFavorites(userId, reelId)` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- `removeFromFavorites(userId, reelId)` - –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
- `hideReel(userId, reelId)` - –°–∫—Ä—ã—Ç–∏–µ Reel
- `getReelInteraction(userId, reelId)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Reel
- `getFavoriteReels(userId, limit, offset)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö Reels

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- `logParsingRun(log)` - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞
- `getParsingLogs(projectId, limit)` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–∫—Ä–∞–ø–∏–Ω–≥–∞

–í —Ñ–∞–π–ª–µ `.env` –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```
MIN_VIEWS=50000 # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –¥–ª—è Reels
MAX_AGE_DAYS=14 # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç Reels –≤ –¥–Ω—è—Ö
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å–∫—Ä–∞–ø–∏–Ω–≥–∞

–î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å cron-–∑–∞–¥–∞—á—É:

```bash
# –ü—Ä–∏–º–µ—Ä –¥–ª—è crontab (—Å–∫—Ä–∞–ø–∏–Ω–≥ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 —É—Ç—Ä–∞)
0 3 * * * cd /path/to/project && bun run src/agents/scraper/scripts/run-daily-scraping.ts >> logs/scraper.log 2>&1
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä —Å–∫—Ä–∞–ø–∏–Ω–≥–∞

```typescript
import {
  initializeNeonStorage,
  closeNeonStorage,
  createUser,
  createProject,
  addCompetitorAccount,
  scrapeInstagramReels,
  saveReels,
} from "./src/agents/scraper"

async function example() {
  await initializeNeonStorage()

  // –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const user = await createUser(123456789, "example_user", "Example", "User")

  // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç
  const project = await createProject(
    user.id,
    "Aesthetic Clinic",
    "Project for tracking competitors",
    "Aesthetic Medicine"
  )

  // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫–∫–∞—É–Ω—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
  const competitor = await addCompetitorAccount(
    project.id,
    "https://www.instagram.com/example_clinic"
  )

  // –°–∫—Ä–∞–ø–∏–º –¥–∞–Ω–Ω—ã–µ
  const reels = await scrapeInstagramReels(competitor.instagram_url, {
    apifyToken: "your_apify_token",
    minViews: 50000,
    maxAgeDays: 14,
  })

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
  const savedCount = await saveReels(
    reels,
    project.id,
    "competitor",
    competitor.id
  )

  console.log(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${savedCount} –Ω–æ–≤—ã—Ö Reels`)

  await closeNeonStorage()
}

example()
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
