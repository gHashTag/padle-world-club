#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
log_info() {
    echo -e "${GREEN}[$(date +"%Y-%m-%d %H:%M:%S")] [INFO]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[$(date +"%Y-%m-%d %H:%M:%S")] [WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[$(date +"%Y-%m-%d %H:%M:%S")] [ERROR]${NC} $1"
}

log_debug() {
    echo -e "${BLUE}[$(date +"%Y-%m-%d %H:%M:%S")] [DEBUG]${NC} $1"
}

# –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø—É—Å–∫–µ
log_info "üöÄ –ó–∞–ø—É—Å–∫ Instagram Scraper Bot –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
log_info "–í–µ—Ä—Å–∏—è Bun: $(bun --version)"
log_info "–í–µ—Ä—Å–∏—è Node: $(node --version)"
log_info "–¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $(pwd)"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ .env
if [ -f .env ]; then
    log_info "–§–∞–π–ª .env –Ω–∞–π–¥–µ–Ω"
else
    log_warning "–§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω. –ë–æ—Ç –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ."
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ index.ts
if [ -f index.ts ]; then
    log_info "–§–∞–π–ª index.ts –Ω–∞–π–¥–µ–Ω"
else
    log_error "–§–∞–π–ª index.ts –Ω–µ –Ω–∞–π–¥–µ–Ω. –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω."
    exit 1
fi

log_info "–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç
bun run index.ts

# –ü–æ–ª—É—á–∞–µ–º –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞
EXIT_CODE=$?

echo ""
if [ $EXIT_CODE -eq 0 ]; then
    log_info "üëã –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞: $EXIT_CODE)"
else
    log_error "‚ùå –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å –æ—à–∏–±–∫–æ–π (–∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞: $EXIT_CODE)"
fi
